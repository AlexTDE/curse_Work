{% extends 'testsystem/base.html' %}

{% block title %}–ü—Ä–æ–≥–æ–Ω—ã - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UI{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <h2>üöÄ –ü—Ä–æ–≥–æ–Ω—ã —Ç–µ—Å—Ç–æ–≤</h2>
        <a href="{% url 'index' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <div style="margin-bottom: 20px;">
        <h3 style="margin-bottom: 15px;">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω</h3>
        <form method="post" action="{% url 'create_run' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label>–¢–µ—Å—Ç-–∫–µ–π—Å:</label>
                <select name="testcase_id" required>
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç-–∫–µ–π—Å</option>
                    {% for tc in testcases %}
                    <option value="{{ tc.id }}">{{ tc.id }} - {{ tc.title }} ({{ tc.get_status_display }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>–¢–µ–∫—É—â–∏–π —Å–∫—Ä–∏–Ω—à–æ—Ç:</label>
                <input type="file" name="actual_screenshot" accept="image/*" required>
            </div>
            <button type="submit" class="btn btn-success">üì∏ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≥–æ–Ω</button>
        </form>
    </div>
    
    <hr style="margin: 30px 0; border: none; border-top: 2px solid #f0f0f0;">
    
    <h3 style="margin-bottom: 15px;">–í—Å–µ –ø—Ä–æ–≥–æ–Ω—ã</h3>
    {% if runs %}
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>–¢–µ—Å—Ç-–∫–µ–π—Å</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ü–æ–∫—Ä—ã—Ç–∏–µ</th>
                <th>–î–µ—Ñ–µ–∫—Ç–æ–≤</th>
                <th>–°–æ–∑–¥–∞–Ω</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for run in runs %}
            <tr>
                <td>{{ run.id }}</td>
                <td><a href="{% url 'testcase_detail' run.testcase.id %}">{{ run.testcase.title }}</a></td>
                <td><span class="badge badge-{{ run.status }}">{{ run.get_status_display }}</span></td>
                <td>
                    {% if run.coverage is not None %}
                        {{ run.coverage|floatformat:1 }}%
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ run.defects.count }}</td>
                <td>{{ run.started_at|date:"d.m.Y H:i" }}</td>
                <td>
                    <div style="display: flex; gap: 5px;">
                        {% if run.status == 'queued' or run.status == 'processing' %}
                        <form method="post" action="{% url 'compare_run' run.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-info btn-small">‚ö° –°—Ä–∞–≤–Ω–∏—Ç—å</button>
                        </form>
                        {% endif %}
                        <a href="{% url 'run_detail' run.id %}" class="btn btn-secondary btn-small">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                        <form method="post" action="{% url 'delete_run' run.id %}" style="display: inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥–æ–Ω #{{ run.id }}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-small">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; text-align: center; padding: 40px;">–ù–µ—Ç –ø—Ä–æ–≥–æ–Ω–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –≤—ã—à–µ.</p>
    {% endif %}
</div>
{% endblock %}

