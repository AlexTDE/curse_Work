{% extends 'testsystem/base.html' %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Jira - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UI{% endblock %}

{% block extra_css %}
<style>
    .alert-warning {
        background: #fff3cd;
        color: #856404;
        border-left: 4px solid #ffc107;
    }
    
    .text-muted {
        color: #6c757d;
    }
    
    .text-success {
        color: #28a745;
    }
    
    code {
        background: #f5f5f5;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
    }
    
    pre {
        overflow-x: auto;
    }
    
    ol, ul {
        margin-left: 20px;
        margin-bottom: 15px;
    }
    
    li {
        margin-bottom: 8px;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Jira</h2>
    </div>
    <div class="card-body">
        <p style="margin-bottom: 20px;">
            –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Jira –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –¥–µ—Ñ–µ–∫—Ç–æ–≤.
            –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (<code>.env</code> —Ñ–∞–π–ª).
        </p>

        {% if not jira_available %}
        <div class="alert alert-warning">
            <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ <code>jira-python</code> –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.
            –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ—ë –∫–æ–º–∞–Ω–¥–æ–π: <code>pip install jira</code>
        </div>
        {% endif %}

        <h3>–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <table class="table" style="margin-bottom: 30px;">
            <tr>
                <th style="width: 200px;">Jira URL:</th>
                <td>
                    {% if current_settings.jira_url %}
                        <code>{{ current_settings.jira_url }}</code>
                    {% else %}
                        <span class="text-muted">–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Username:</th>
                <td>
                    {% if current_settings.jira_username %}
                        <code>{{ current_settings.jira_username }}</code>
                    {% else %}
                        <span class="text-muted">–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>API Token:</th>
                <td>
                    {% if current_settings.jira_api_token %}
                        <span class="text-success">‚úì –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ</span>
                    {% else %}
                        <span class="text-muted">–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Project Key:</th>
                <td>
                    {% if current_settings.jira_project_key %}
                        <code>{{ current_settings.jira_project_key }}</code>
                    {% else %}
                        <span class="text-muted">–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span>
                    {% endif %}
                </td>
            </tr>
        </table>

        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jira</h3>
        <p style="margin-bottom: 15px;">
            –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏—Ö. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ñ–∞–π–ª <code>.env</code>.
        </p>

        <form method="post" style="margin-bottom: 30px;">
            {% csrf_token %}
            <div class="form-group">
                <label for="jira_url">Jira URL *</label>
                <input type="text" id="jira_url" name="jira_url" 
                       value="{{ current_settings.jira_url }}" 
                       placeholder="https://your-company.atlassian.net" required>
                <small style="color: #6c757d;">–ü–æ–ª–Ω—ã–π URL –≤–∞—à–µ–≥–æ Jira (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://company.atlassian.net)</small>
            </div>

            <div class="form-group">
                <label for="jira_username">Username (Email) *</label>
                <input type="text" id="jira_username" name="jira_username" 
                       value="{{ current_settings.jira_username }}" 
                       placeholder="your-email@example.com" required>
                <small style="color: #6c757d;">Email –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –≤—Ö–æ–¥–∞ –≤ Jira</small>
            </div>

            <div class="form-group">
                <label for="jira_api_token">API Token *</label>
                <input type="password" id="jira_api_token" name="jira_api_token" 
                       value="" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å)" 
                       {% if not current_settings.jira_api_token %}required{% endif %}>
                <small style="color: #6c757d;">
                    API —Ç–æ–∫–µ–Ω –∏–∑ <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank">Atlassian Account Settings</a>.
                    {% if current_settings.jira_api_token %}
                    <br>–¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω. –û—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å –µ–≥–æ.
                    {% endif %}
                </small>
            </div>

            <div class="form-group">
                <label for="jira_project_key">Project Key *</label>
                <input type="text" id="jira_project_key" name="jira_project_key" 
                       value="{{ current_settings.jira_project_key }}" 
                       placeholder="TEST" required>
                <small style="color: #6c757d;">–ö–ª—é—á –ø—Ä–æ–µ–∫—Ç–∞ –≤ Jira (–Ω–∞–ø—Ä–∏–º–µ—Ä, TEST, PROJ, DEV)</small>
            </div>

            <div style="margin-top: 20px;">
                <button type="submit" name="save_settings" class="btn btn-primary">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
                <button type="submit" name="test_connection" class="btn btn-info">
                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                </button>
            </div>
        </form>

        {% if connection_status == 'success' %}
        <div class="alert alert-success">
            <strong>‚úì –£—Å–ø–µ—à–Ω–æ!</strong> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Jira —Ä–∞–±–æ—Ç–∞–µ—Ç.
        </div>
        {% elif connection_status == 'error' %}
        <div class="alert alert-danger">
            <strong>‚úó –û—à–∏–±–∫–∞:</strong> {{ connection_error }}
        </div>
        {% endif %}

        <h3>–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å</h3>
        <ol>
            <li>
                <strong>–ü–æ–ª—É—á–∏—Ç–µ API —Ç–æ–∫–µ–Ω:</strong>
                <ul>
                    <li>–ó–∞–π–¥–∏—Ç–µ –Ω–∞ <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank">https://id.atlassian.com/manage-profile/security/api-tokens</a></li>
                    <li>–ù–∞–∂–º–∏—Ç–µ "Create API token"</li>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω</li>
                </ul>
            </li>
            <li>
                <strong>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –≤—ã—à–µ</strong> –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
            </li>
            <li>
                <strong>–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Django —Å–µ—Ä–≤–µ—Ä</strong> —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª <code>.env</code>)
            </li>
            <li>
                <strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</strong> —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"
            </li>
        </ol>
        
        <div class="alert alert-warning" style="margin-top: 20px;">
            <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Django —Å–µ—Ä–≤–µ—Ä, 
            —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ <code>.env</code> –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É.
        </div>

        <h3>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h3>
        <ul>
            <li>–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –¥–µ—Ñ–µ–∫—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –≤ Jira</li>
            <li>–ö–ª—é—á –∑–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ <code>task_tracker_issue</code> –ø—Ä–æ–≥–æ–Ω–∞</li>
            <li>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–µ—Ñ–µ–∫—Ç–µ (severity, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å–∫—Ä–∏–Ω—à–æ—Ç) –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–¥–∞—á—É</li>
            <li>–ï—Å–ª–∏ Jira –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á</li>
        </ul>

        <div style="margin-top: 30px;">
            <a href="{% url 'index' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>
</div>
{% endblock %}

